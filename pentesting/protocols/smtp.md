# SMTP

**The Simple Mail Transfer Protocol (SMTP) is a protocol for sending emails in an IP network.** It can be used between an email client and an outgoing mail server or between two SMTP servers. SMTP is often combined with the `IMAP` or `POP3` protocols, which can fetch emails and send emails. In principle, it is a client-server-based protocol, although SMTP can be used between a client and a server and between two SMTP servers.

### SMTP Servers

SMTP servers play a crucial role in preventing spam by supporting `ESMTP` with `SMTP-Auth` for authorized user-based email sending. **The Mail User Agent (`MUA`)** converts emails into headers and bodies, uploading them to the SMTP server. A **Mail Transfer Agent (`MTA`)** checks email size and spam, storing it after validation. Occasionally, a Mail Submission Agent (`MSA`) or Relay server validates email origin to prevent `Open Relay` Attacks. The MTA then searches DNS for the recipient mail server's IP address.

```bash
MUA(Client) -> MSA(Submission Agent) -> MTA(Open Relay) -> MDA(Mail Delivery Agent) -> POP3/IMAP(Mailbox)
```

But SMTP has some disadvantages:

1. Sending an email using SMTP doesn't return usable delivery confirmation.
2. Users are not authenticated when a connection is established, and the sender of an email is therefore unreliable. As a result, open SMTP relays are often misused to send spam a lot For this purpose, an extension for SMTP has been developed called Extended SMTP (`ESMTP`). When people talk about SMTP in general, they usually mean ESMTP

### Tips2Hack

1. You can try to enumerate users via Telnet VRFY

```bash
> telnet 13.13.13.13 25
> VRFY carnifex17
252 2.0.0 carnifex17
```

2. Nmap - Open Relay

```bash
sudo nmap 13.13.13.13 -p25 --script smtp-open-relay -v
```

3. SMTP - Nmap all enum

```bash
sudo nmap 13.13.13.13 -p25 -sV -sC --script smtp* -v
```

***
