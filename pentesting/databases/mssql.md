# MSSQL

**Microsoft SQL (MSSQL) is Microsoft's SQL-based relational database management system.** It is popular among database administrators and developers when building applications that run on Microsoft's .NET framework due to its strong native support for .NET. MSSQL have a lot of different targets. Default port is 1433

### Databases

MSSQL has default system databases that can help us understand the structure of all the databases that may be hosted on a target server.

| Database   | Description                                                                                                                                                                                            |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `master`   | Tracks all system information for an SQL server instance                                                                                                                                               |
| `model`    | Template database that acts as a structure for every new database created. Any setting changed in the model database will be reflected in any new database created after changes to the model database |
| `msdb`     | The SQL Server Agent uses this database to schedule jobs & alerts                                                                                                                                      |
| `tempdb`   | Stores temporary objects                                                                                                                                                                               |
| `resource` | Read-only database containing system objects included with SQL server                                                                                                                                  |

### Tips2Hack

1. Nmap MSSQL Script Scan

```bash
sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 13.13.13.13
```

2. Metasploit scan. We can user `mssql_ping` to get more useful info about MSSQL server.

```bash
msf6 auxiliary(scanner/mssql/mssql_ping) > set rhosts 13.13.13.13

rhosts => 13.13.13.13

msf6 auxiliary(scanner/mssql/mssql_ping) > run

[*] 10.129.201.248:       - SQL Server information for 13.13.13.13:
[+] 10.129.201.248:       -    ServerName      = SQL-01
[+] 10.129.201.248:       -    InstanceName    = MSSQLSERVER
[+] 10.129.201.248:       -    IsClustered     = No
[+] 10.129.201.248:       -    Version         = 15.0.2000.5
[+] 10.129.201.248:       -    tcp             = 1433
[+] 10.129.201.248:       -    np              = \\SQL-01\pipe\sql\query
[*] 10.129.201.248:       - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```

3. Connecting with Mssqlclient.py

```bash
python3 mssqlclient.py Administrator@13.13.13.13 -windows-auth
```

***
